# Medical Federated Learning with Watermarking

åŸºäºè”é‚¦å­¦ä¹ çš„åŒ»å­¦å›¾åƒåˆ†ç±»é¡¹ç›®ï¼Œé›†æˆæ°´å°æŠ€æœ¯ä¿æŠ¤æ¨¡å‹çŸ¥è¯†äº§æƒï¼Œæ”¯æŒå¤šç§æ”»å‡»å®éªŒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡
```bash
pip install torch torchvision numpy matplotlib scikit-learn tqdm pandas
```

### 1. è®­ç»ƒè‡ªç¼–ç å™¨
```bash
python train_autoencoder.py
```

### 2. ç”Ÿæˆå¯†é’¥çŸ©é˜µ
```bash
python train_key_matrix.py --model_type resnet --client_num 10 --dataset chestmnist
```

### 3. è”é‚¦å­¦ä¹ è®­ç»ƒ
```bash
python main.py --model resnet --dataset chestmnist --client_num 10 --epochs 100
```

### 4. æ”»å‡»å®éªŒ
```bash
# å¾®è°ƒæ”»å‡»
python finetune_attack.py --model_path ./save/resnet/chestmnist/model.pkl

# å‰ªææ”»å‡»  
python pruning_attack.py --model_path ./save/resnet/chestmnist/model.pkl
```

## ğŸ“Š æ”¯æŒçš„æ•°æ®é›†

| æ•°æ®é›† | ç±»å‹ | ç±»åˆ«æ•° | ä»»åŠ¡ |
|--------|------|--------|------|
| ChestMNIST | åŒ»å­¦å›¾åƒ | 14 | å¤šæ ‡ç­¾åˆ†ç±» |
| CIFAR-10 | è‡ªç„¶å›¾åƒ | 10 | å¤šåˆ†ç±» |
| CIFAR-100 | è‡ªç„¶å›¾åƒ | 100 | å¤šåˆ†ç±» |

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ main.py                 # è”é‚¦å­¦ä¹ ä¸»ç¨‹åº
â”œâ”€â”€ finetune_attack.py     # å¾®è°ƒæ”»å‡»å®éªŒ
â”œâ”€â”€ pruning_attack.py      # å‰ªææ”»å‡»å®éªŒ
â”œâ”€â”€ train_autoencoder.py   # è‡ªç¼–ç å™¨è®­ç»ƒ
â”œâ”€â”€ train_key_matrix.py    # å¯†é’¥çŸ©é˜µç”Ÿæˆ
â”œâ”€â”€ models/                # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ resnet.py         # ResNet18
â”‚   â”œâ”€â”€ alexnet.py        # AlexNet
â”‚   â””â”€â”€ light_autoencoder.py
â”œâ”€â”€ utils/                 # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ dataset.py        # æ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ trainer_private.py # è®­ç»ƒå™¨
â”‚   â”œâ”€â”€ watermark_reconstruction.py # æ°´å°é‡å»º
â”‚   â””â”€â”€ delta_pcc_utils.py # Î”PCCè¯„ä¼°
â””â”€â”€ save/                 # ç»“æœä¿å­˜
    â”œâ”€â”€ autoencoder/      # è‡ªç¼–ç å™¨æƒé‡
    â”œâ”€â”€ key_matrix/       # å¯†é’¥çŸ©é˜µ
    â””â”€â”€ excel/           # å®éªŒç»“æœ
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### æ°´å°ç³»ç»Ÿ
- **å¯†é’¥çŸ©é˜µç”Ÿæˆ**ï¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆå”¯ä¸€æ°´å°ä½ç½®
- **æ°´å°åµŒå…¥**ï¼šè®­ç»ƒè¿‡ç¨‹ä¸­åµŒå…¥æ°´å°åˆ°æ¨¡å‹å‚æ•°
- **æ°´å°éªŒè¯**ï¼šæ”¯æŒæ°´å°æå–å’Œå®Œæ•´æ€§éªŒè¯
- **Î”PCCè¯„ä¼°**ï¼šé‡åŒ–æ°´å°å®Œæ•´æ€§å˜åŒ–

### è”é‚¦å­¦ä¹ 
- **å¤šå®¢æˆ·ç«¯è®­ç»ƒ**ï¼šæ”¯æŒIID/éIIDæ•°æ®åˆ†å¸ƒ
- **æ¨¡å‹èšåˆ**ï¼šFedAvgç®—æ³•
- **éšç§ä¿æŠ¤**ï¼šå¯é€‰å·®åˆ†éšç§æœºåˆ¶
- **æ°´å°ç¼©æ”¾**ï¼šè‡ªé€‚åº”æ°´å°å‚æ•°è°ƒæ•´

### æ”»å‡»å®éªŒ
- **å¾®è°ƒæ”»å‡»**ï¼šæ¨¡æ‹Ÿæ¨¡å‹å¾®è°ƒå¯¹æ°´å°çš„å½±å“
- **å‰ªææ”»å‡»**ï¼šæµ‹è¯•æ¨¡å‹å‰ªæå¯¹æ°´å°çš„ç ´åæ€§
- **å®Œæ•´æ€§è¯„ä¼°**ï¼šé‡åŒ–æ”»å‡»å¯¹æ°´å°çš„ç ´åç¨‹åº¦

## âš™ï¸ ä¸»è¦å‚æ•°

```bash
# åŸºç¡€é…ç½®
--model resnet              # æ¨¡å‹ç±»å‹ (resnet/alexnet)
--dataset chestmnist        # æ•°æ®é›†
--client_num 10            # å®¢æˆ·ç«¯æ•°é‡
--epochs 100               # è®­ç»ƒè½®æ•°

# æ°´å°é…ç½®
--watermark_mode enhanced   # æ°´å°æ¨¡å¼
--use_key_matrix           # ä½¿ç”¨å¯†é’¥çŸ©é˜µ
--enable_watermark_scaling # å¯ç”¨æ°´å°ç¼©æ”¾

# éšç§ä¿æŠ¤
--dp                       # å¯ç”¨å·®åˆ†éšç§
--sigma 0.1                # å™ªå£°å¼ºåº¦
```

## ğŸ“ˆ å®éªŒç»“æœ

é¡¹ç›®æ”¯æŒå¤šç§è¯„ä¼°æŒ‡æ ‡ï¼š
- **å‡†ç¡®ç‡**ï¼šæ¨¡å‹åˆ†ç±»æ€§èƒ½
- **AUC**ï¼šå¤šæ ‡ç­¾åˆ†ç±»æ€§èƒ½
- **æ°´å°å®Œæ•´æ€§**ï¼šæ°´å°æå–æˆåŠŸç‡
- **Î”PCCå€¼**ï¼šæ°´å°å‚æ•°ç›¸å…³æ€§å˜åŒ–

## ğŸ“ æ³¨æ„äº‹é¡¹

- ç¡®ä¿GPUå†…å­˜å……è¶³ï¼ˆå»ºè®®8GB+ï¼‰
- æ•°æ®æ–‡ä»¶éœ€æ”¾åœ¨`data/`ç›®å½•
- è®­ç»ƒç»“æœä¿å­˜åœ¨`save/`ç›®å½•
- æ”¯æŒWindowså¤šè¿›ç¨‹å…¼å®¹

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦æœ¯ç ”ç©¶ä½¿ç”¨ã€‚